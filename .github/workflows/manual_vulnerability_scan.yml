name: Manual Vulnerability Scan

on:
  push:
  workflow_dispatch:
    inputs:
      arch: 
        type: string
        description: "Image architecture (amd64|arm64)"
        required: true
      image_url:
        type: string
        description: "URL of docker image to scan"
        required: true
      run_trivy:
        type: boolean
        description: "Scan with Trivy"
        default: true
      run_grype:
        type: boolean
        description: "Scan with Grype"
        default: true
      run_cbt:
        type: boolean
        description: "Scan with CVE-bin-tool"
        default: true

jobs:
  manual-cve-scan:
    name: Manual CVE Scan
    if: ${{ github.event_name == 'workflow_dispatch' }}
    uses: ./.github/workflows/reusable_vulnerability_scan.yml
    with:
      arch: ${{ inputs.arch }}
      image_url: ${{ inputs.image_url }}
      run_trivy: ${{ inputs.run_trivy }}
      run_grype: ${{ inputs.run_grype }}
      run_cbt: ${{ inputs.cbt }}
    secrets: inherit
    
  # DELETE ME BEFORE MERGE!!!!!
  push-cve-scan:
    name: Manual CVE Scan
    if: ${{ github.event_name == 'push' }}
    uses: ./.github/workflows/reusable_vulnerability_scan.yml
    with:
      arch: "amd64"
      image_url: "https://s3.eu-west-1.amazonaws.com/deps.memgraph.io/daily-build/mage/20250529/mage-3.2.1_pr614_e23ca9d-memgraph-3.2.1_pr2992_b3001424ecb4.tar.gz"
      run_trivy: true
      run_grype: true
      run_cbt: false
    secrets: inherit
