name: Build and Test

env:
  PY_VERSION: "3.9"
  CORE_COUNT: "8"
  MAGE_CONTAINER: "mage"

on: [pull_request, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-20.04
    env:
      MEMGRAPH_VERSION: 2.2.0

    steps:
      - uses: actions/checkout@v2

      - name: Set up C++
        run: |
          sudo apt update
          sudo apt install -y build-essential cmake

      - name: Print C++ Version
        run: |
          gcc --version
          g++ --version

      - name: Build C++ modules
        run: |
          mkdir -p cpp/build
          cd cpp/build
          cmake ..
          make -j${{ env.CORE_COUNT }}

      - name: C++ Modules unit tests
        if: matrix.target == 'dev'
        run: |
          cd cpp/build
          ctest -j${{ env.CORE_COUNT }}